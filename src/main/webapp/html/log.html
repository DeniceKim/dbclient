<!DOCTYPE html>
<html>
<head>
<title>LogView</title>
<link href='css/global.css' rel='stylesheet' type='text/css' />
<link href='lib/jquery-ui-1.11.2/jquery-ui.min.css' media='screen' rel='stylesheet' type='text/css' />
<script src='lib/jquery-1.8.0.min.js' type='text/javascript'></script>
<script src='lib/jquery-ui-1.11.2/jquery-ui.min.js' type='text/javascript'></script>
<script src='lib/utils.js' type='text/javascript'></script>
<script type="text/javascript">

var timeInterval = null;

var autoLog = function(isAuto){
	if(isAuto="true" && timeInterval==null){
		timeInterval = window.setInterval(getSysLog, 1000);		
		$("#message").html("자동으로 수집중입니다.");
	} else {
		window.clearInterval(timeInterval);
		timeInterval=null;
		$("#message").html("자동 수집이 중지되었습니다.");
	}
}

var getSysLog = function(){
	$.getJSON( "/log/getSysFileLog", function( data ) {
		showLoading();
		var html='';
		var isModify = false;
		if(data.status == '200'){
			$.each(data.result, function() {
				if(document.getElementById('logid'+this.time) == null){
					html+='<div id="logid'+this.time+'"><pre>' + this.message + '</pre></div>';
					isModify=true;
				}
			})
			$("#logs").html($("#logs").html()+html);
		} else {
			$("#logs").html("로그가 없습니다.");
		}
		if(isModify){
			resizeQueryResult();			
		}
		
		// 3천개가 넘으면 상단에 일부를 삭제한다.
		if($("#logs").find(" > div").length > 250){
			$("#logs").find(" > div").each(function(loop){
				if(loop<50)
					$(this).remove();	
			});
		}
		
		fillter();
		
		$("#rowCount").html("화면 로그 개수 : "+$("#logs").find(" > div").length + " 개");
		$("#message2").html("화면갱신"+new Date());
		hideLoading();
	});
};

var resizeQueryResult=function(){
	console.log($(document));
	
	$("#writeLogs").css('height','auto');
	if(parseInt($("#writeLogs").height()) >=500){
		$("#writeLogs").css('height','500px');
		$("#writeLogs").css('overflow','scroll');
		$("#writeLogs").css('overflow-x','hidden');
	}
	else{
		$("#queryResult").css('overflow','visible');
	}
	var objDiv = document.getElementById("writeLogs");
	objDiv.scrollTop = objDiv.scrollHeight;
};

var clearfillter = function(){
	$("#logs").find(" > div").each(function(loop){
		$(this).show();
	});
	$("[name='search']").val("");
}

var fillter = function(){
	if($("[name='search']").val().trim()!=""){
		$("#logs").find(" > div").each(function(loop){
			$(this).show();
			if($(this).html().indexOf($("[name='search']").val()) == -1){
				$(this).hide();
			}
		});
	}
}

</script>
</head>
<body>
	<div id="loading" style="display: none;position: absolute;width: 300px;height: 35px;top:300px;left:30% ;background:gray;">
		<div style="color: white;"> <br/> <strong> Lading Now ......</strong> </div>
	</div>
	<div class="header">
		<div id="topMenu">
			<table>
				<tr>
					<td valign="top">
						<div id="logo"></div>
						<div id="marketPlaceList" style="text-align: left">
							<h1> FileLogView </h1>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<div id="topPadding"></div>
	</div>
	<div id="wrapper-outer">
		<div id="wrapper" align="center">

				<div style="width: 100%">
					<div id="log-view">
						<br/>
						<div class="header" style="text-align: left;padding: 4px 7px 3px 7px;"> 
							|	<a href="javascript:getSysLog();">한번</a> 
							| 	<a href="javascript:autoLog('true');">자동</a> 
							| 	<a href="javascript:autoLog('false');">멈춤</a> 
							|	필터 : <input type="text" name="search" value="">
							| 	<a href="javascript:clearfillter();">필터리셋</a>
							| <span id="rowCount"></span>
							| <span id="message"></span>
							| <span id="message2"></span>
						</div>
						<br/>
						<div id="writeLogs">
							<div id="logs" style="text-align: left;padding: 4px 7px 3px 7px;"></div>
						</div>
					</div>
				</div>

		</div>
	</div>
	<div id="bottomMenu">
		<table>
			<tr>
				<td>Copyrightⓒ Song7749 Co., Ltd. All Rights Reserved.</td>
			</tr>
		</table>
	</div>
</body>
</html>